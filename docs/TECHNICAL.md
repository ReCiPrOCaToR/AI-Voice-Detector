# AI语音检测器技术文档

## 技术概述

AI语音检测器扩展通过分析音频特征来识别视频中的AI合成语音。特别针对高质量AI配音（如微软云熙）进行了优化，使用了多种音频分析技术来提高检测精度。

## 主要组件

### 1. 音频分析器 (AudioAnalyzer)

音频分析器负责从音频数据中提取特征并执行分析。主要功能包括：

- **特征提取**：计算音高变化、过零率、能量分布、频谱质心等特征
- **相似度计算**：比较当前音频与已标记的AI声音样本的相似度
- **默认规则检测**：当没有足够标记样本时，使用预设规则判断

### 2. 声音检测器 (AIVoiceDetector)

声音检测器负责监控网页上的视频元素，并应用音频分析。主要功能包括：

- **视频元素处理**：监听网页上新增的视频元素
- **音频上下文管理**：创建和管理Web Audio API资源
- **实时分析**：周期性分析当前播放视频的音频
- **两阶段标记**：支持用户标记音频片段的开始和结束

### 3. 后台脚本 (Background)

后台脚本负责处理通知和消息传递。主要功能包括：

- **通知管理**：显示检测结果的通知
- **消息中继**：在内容脚本和弹出窗口之间传递消息

### 4. 弹出界面 (Popup)

弹出界面提供用户控制和显示结果。主要功能包括：

- **开始/停止检测**：控制检测过程
- **标记AI语音**：允许用户标记特定音频为AI配音
- **显示检测结果**：展示实时检测结果
- **管理标记列表**：查看和删除已标记的样本

## 技术细节

### 音频特征提取

扩展使用以下特征来分析音频：

1. **音高变化 (Pitch Variation)**
   - 计算方法：分析音频块之间的过零率变化
   - 意义：AI语音通常有更规则的音高变化模式

2. **频谱质心 (Spectral Centroid)**
   - 计算方法：加权平均频率分布
   - 意义：反映音色的"亮度"，AI语音有特定范围的频谱质心

3. **过零率 (Zero-Crossing Rate)**
   - 计算方法：计算音频信号从正变负或从负变正的次数
   - 意义：与音高相关，AI语音通常有特定范围的过零率

4. **能量分布 (Energy Distribution)**
   - 计算方法：计算音频信号的均方根能量
   - 意义：AI语音通常能量分布更均匀

### 相似度计算

使用加权欧氏距离来计算音频特征之间的相似度：

1. **特征加权**：不同特征有不同权重，频谱质心权重最高(0.3)
2. **距离计算**：计算当前特征与标记样本特征的加权欧氏距离
3. **相似度转换**：使用负指数函数将距离转换为相似度分数
4. **阈值判断**：相似度超过设定阈值(0.85-0.95)判定为AI语音

### 检测敏感度设置

提供5级敏感度设置，调整以下参数：

1. **相似度阈值**：从0.85(高敏感度)到0.95(低敏感度)
2. **必要条件比率**：在默认规则检测中，满足条件的比率要求
3. **距离系数**：控制距离到相似度转换的陡峭程度

### 音频处理流程

1. **初始化**：扫描页面上的视频元素，创建音频上下文和分析器
2. **实时分析**：每120毫秒采样一次音频数据进行分析
3. **连续判断**：使用连续检测结果来提高稳定性
4. **结果通知**：将检测结果发送给弹出窗口和通知系统

### 标记系统实现

两阶段标记流程：

1. **开始标记**：记录当前视频时间，开始收集音频数据
2. **完成标记**：记录结束时间，计算标记持续时间
3. **特征聚合**：计算标记期间所有采样的平均特征值
4. **存储标记**：将标记信息保存到Chrome存储中

## 性能优化

- **节流处理**：限制音频分析频率(120毫秒一次)
- **资源管理**：适当清理不再使用的音频资源
- **条件分析**：只在必要时执行完整分析
- **错误恢复**：在各个环节添加错误处理，确保稳定运行

## 已知限制

- 对于没有音频轨道的视频无法分析
- 在某些网站上可能需要手动开始检测
- 高质量AI配音可能需要更多的标记样本才能准确识别 